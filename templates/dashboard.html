<!-- templates/dashboard.html -->
{% extends 'base.html' %}

{% block content %}
<div class="dashboard">
    <div class="dashboard-header">
        <h2>Welcome, {{ user.username }}</h2>
        <div class="balance-card">
            <h3>Your Balance</h3>
            <p class="balance-amount">₦{{ "%.2f"|format(user.balance) }}</p>
            <div class="balance-actions">
                <a href="{{ url_for('deposit') }}" class="btn btn-small"><button>Deposit</button></a>
                <a href="{{ url_for('withdraw') }}" class="btn btn-small"><button>Withdraw</button></a>
            </div>
        </div>
    </div>
    
    <div class="dashboard-section">
        <h3>Available Loan Requests</h3>
        {% if loan_requests %}
        <div class="loan-requests">
            {% for loan in loan_requests %}
            {% if loan.requester_id != user.id %}
            <div class="loan-card">
                <div class="loan-details">
                    <h4>₦{{ "%.2f"|format(loan.amount) }} at {{ loan.interest_rate }}%</h4>
                    <p><strong>Duration:</strong> {{ loan.duration_months }} months</p>
                    <p><strong>Purpose:</strong> {{ loan.purpose }}</p>
                    <p><strong>Requested by:</strong> {{ loan.requester.username }}</p>
                    <p><strong>Date:</strong> {{ loan.created_at.strftime('%Y-%m-%d') }}</p>
                </div>
                <div class="loan-actions">
                    <a href="{{ url_for('fund_loan', loan_id=loan.id) }}" class="btn btn-primary"><button>Fund This Loan</button></a>
                </div>
            </div>
            {% endif %}
            {% endfor %}
        </div>
        {% else %}
        <p>No loan requests available at the moment.</p>
        {% endif %}
    </div>
    
    <div class="dashboard-section">
        <h3>Your Loan Requests</h3>
        {% if my_loan_requests %}
        <div class="loan-requests">
            {% for loan in my_loan_requests %}
            <div class="loan-card">
                <div class="loan-details">
                    <h4>₦{{ "%.2f"|format(loan.amount) }} at {{ loan.interest_rate }}%</h4>
                    <p><strong>Duration:</strong> {{ loan.duration_months }} months</p>
                    <p><strong>Purpose:</strong> {{ loan.purpose }}</p>
                    <p><strong>Status:</strong> {{ loan.status.title() }}</p>
                    <p><strong>Date:</strong> {{ loan.created_at.strftime('%Y-%m-%d') }}</p>
                    {% if loan.funder %}
                    <p><strong>Funded by:</strong> {{ loan.funder.username }}</p>
                    <p><strong>Funded on:</strong> {{ loan.funded_at.strftime('%Y-%m-%d') }}</p>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <p>You haven't made any loan requests yet.</p>
        {% endif %}
    </div>
    
    <div class="dashboard-section">
        <h3>Loans You've Funded</h3>
        {% if my_funded_loans %}
        <div class="loan-requests">
            {% for loan in my_funded_loans %}
            <div class="loan-card">
                <div class="loan-details">
                    <h4>₦{{ "%.2f"|format(loan.amount) }} at {{ loan.interest_rate }}%</h4>
                    <p><strong>Duration:</strong> {{ loan.duration_months }} months</p>
                    <p><strong>Purpose:</strong> {{ loan.purpose }}</p>
                    <p><strong>Requested by:</strong> {{ loan.requester.username }}</p>
                    <p><strong>Status:</strong> {{ loan.status.title() }}</p>
                    <p><strong>Funded on:</strong> {{ loan.funded_at.strftime('%Y-%m-%d') }}</p>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <p>You haven't funded any loans yet.</p>
        {% endif %}
    </div>
</div>
{% endblock %}